function parseSakai() {
  let text = document.getElementById('sakaiText').value;
  if (!text.trim()) return alert('Please paste your Sakai text first.');

  // Extract only the "Title ... Gateway" region
  const match = text.match(/Title[\s\S]*?(?=Gateway|Accessibility Information|The Sakai Project)/i);
  const section = match ? match[0] : text;
  const lines = section.split(/\n+/);
  const scores = [];

  for (let line of lines) {
    const lower = line.toLowerCase();

    // ✅ Must contain "lab" or "safety", and at least one number AFTER "n/a"
    if (!(lower.startsWith('lab') || lower.includes('safety'))) continue;
    if (lower.includes('title') || lower.includes('statistics')) continue;

    // remove n/a, Highest, commas, etc.
    line = line.replace(/n\/a|highest|,/gi, '').trim();

    // ✅ Grab all numbers but ignore if they look like dates (e.g. "2025" or a month day)
    const nums = (line.match(/\b\d+(?:\.\d+)?\b/g) || [])
      .map(n => parseFloat(n))
      .filter(n => n <= 10); // ignore years, times, or "2025"

    if (!nums.length) continue;

    // Take the last numeric value — the actual recorded score
    const earned = nums[nums.length - 1];
    if (isNaN(earned) || earned === 0) continue;

    // ✅ Safety Quiz = /10, everything else = /2
    const max = (lower.includes('safety') && lower.includes('quiz')) ? 10 : 2;

    scores.push({ name: line.trim(), earned, max });
  }

  if (!scores.length) {
    alert('No valid Sakai grades found.');
    return;
  }

  const cat = classifyAssignments(scores);
  calculateTotals(cat);
}
